<div class="tab-content">
  <div class="content-layout">
    <div class="content-section">
      <div class="section-header">
        <div>
          <h2>Testimonials</h2>
          <p class="section-description">
            Edit testimonial cards displayed on the testimonials section.
          </p>
        </div>
        <button type="button" class="btn-add" (click)="addNewTestimonial()">
          <span>+</span> Add New Testimonial
        </button>
      </div>

      @if (sortedTestimonials.length > 0) {
        <div class="testimonial-cards-container">
          @for (testimonial of sortedTestimonials; track testimonial.id || $index) {
            <div
              class="testimonial-card"
              #testimonialCard
              [attr.data-testimonial-id]="testimonial.id"
              [class.editing]="isEditing(testimonial)"
            >
              <div class="testimonial-card-header">
                <div class="testimonial-meta">
                  <div class="testimonial-name">
                    {{ testimonial.name || 'Untitled Testimonial' }}
                  </div>
                  <div class="testimonial-role">
                    {{ testimonial.role || 'Role not set' }}
                  </div>
                </div>
                <div class="testimonial-card-actions">
                  @if (!isEditing(testimonial)) {
                    <button
                      type="button"
                      (click)="startEdit(testimonial)"
                      class="btn-icon"
                      title="Edit"
                    >
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path
                          d="M11.333 2.667a1.333 1.333 0 0 1 1.885 1.885L5.333 12.667l-2.667.667.667-2.667L11.333 2.667z"
                          stroke="currentColor"
                          stroke-width="1.5"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </button>
                    <button
                      type="button"
                      (click)="deleteTestimonial(testimonial)"
                      [disabled]="isDeleting(testimonial)"
                      class="btn-icon btn-delete"
                      title="Delete"
                    >
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path
                          d="M4 4L12 12M12 4L4 12"
                          stroke="currentColor"
                          stroke-width="1.5"
                          stroke-linecap="round"
                        />
                      </svg>
                    </button>
                  }
                </div>
              </div>

              @if (!isEditing(testimonial)) {
                <div class="testimonial-card-content">
                  <p class="testimonial-text">
                    {{ testimonial.text }}
                  </p>
                </div>
              }

              @if (isEditing(testimonial)) {
                <div class="testimonial-card-edit">
                  <div class="form-group">
                    <label>Name</label>
                    <input
                      type="text"
                      [(ngModel)]="testimonial.name"
                      name="name_{{ testimonial.id }}"
                      required
                      class="form-input"
                    />
                    <small class="form-hint">Name of the person giving the testimonial</small>
                  </div>

                  <div class="form-group">
                    <label>Role</label>
                    <input
                      type="text"
                      [(ngModel)]="testimonial.role"
                      name="role_{{ testimonial.id }}"
                      required
                      class="form-input"
                    />
                    <small class="form-hint">Role or title of the person</small>
                  </div>

                  <div class="form-group">
                    <label>Testimonial Text</label>
                    <textarea
                      [(ngModel)]="testimonial.text"
                      name="text_{{ testimonial.id }}"
                      required
                      rows="4"
                      class="form-textarea"
                    ></textarea>
                    <small class="form-hint">The testimonial content</small>
                  </div>

                  <div class="form-group">
                    <label>Avatar URL</label>
                    <input
                      type="text"
                      [(ngModel)]="testimonial.avatar"
                      name="avatar_{{ testimonial.id }}"
                      class="form-input"
                    />
                    <small class="form-hint">URL to the person's avatar image</small>
                  </div>

                  <div class="form-actions">
                    <button
                      type="button"
                      (click)="saveTestimonial(testimonial)"
                      [disabled]="isSaving(testimonial)"
                      class="btn-primary"
                    >
                      {{ isSaving(testimonial) ? 'Saving...' : 'Save' }}
                    </button>
                    <button
                      type="button"
                      (click)="cancelEdit(testimonial)"
                      [disabled]="isSaving(testimonial)"
                      class="btn-secondary"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }

      @if (sortedTestimonials.length === 0) {
        <div class="empty-state">
          <p>No testimonials found. Click "Add New Testimonial" to create one.</p>
        </div>
      }

      @if (error) {
        <div class="error-message">
          {{ error }}
        </div>
      }

      @if (successMessage) {
        <div class="success-message">
          {{ successMessage }}
        </div>
      }
    </div>

    <!-- Optional preview: show first editing testimonial if any are being edited -->
    @if (previewTestimonial) {
      <div class="preview-section">
        <h2>Preview</h2>
        <div class="preview-card preview-testimonial-card">
          <div class="preview-testimonial-content">
            @if (previewTestimonial.avatar) {
              <div class="preview-testimonial-avatar">
                <img
                  [src]="previewTestimonial.avatar || ''"
                  [alt]="previewTestimonial.name || 'Avatar'"
                  class="preview-avatar"
                  loading="lazy"
                />
              </div>
            }
            <div class="preview-testimonial-text">
              <p class="preview-testimonial-quote">
                {{ previewTestimonial.text || 'Testimonial text will appear here...' }}
              </p>
            </div>
            <div class="preview-testimonial-author">
              <h4 class="preview-testimonial-name">
                {{ previewTestimonial.name || 'Name' }}
              </h4>
              <p class="preview-testimonial-role">
                {{ previewTestimonial.role || 'Role' }}
              </p>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
