<div class="custom-dropdown" [attr.aria-expanded]="isOpen" [attr.aria-haspopup]="true" role="combobox">
  @if (label) {
    <label [for]="id" class="dropdown-label">{{ label }}</label>
  }
  <div 
    class="dropdown-trigger"
    [class.open]="isOpen"
    [class.has-selection]="internalSelectedValue"
    (click)="toggleDropdown()"
    [attr.aria-label]="label || 'Select option'"
    tabindex="0"
    role="button"
    [attr.aria-expanded]="isOpen"
  >
    <span class="dropdown-text">{{ displayText }}</span>
    <svg class="dropdown-arrow" [class.open]="isOpen" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path d="M8 11L3 6H13L8 11Z" fill="currentColor"/>
    </svg>
  </div>
  
  @if (isOpen) {
    <div class="dropdown-menu" role="listbox" (click)="$event.stopPropagation()">
      @for (option of options; track option.value) {
        <div
          class="custom-dropdown-option"
          [class.selected]="option.value === internalSelectedValue"
          [class.focused]="$index === focusedIndex"
          [attr.data-index]="$index"
          [attr.role]="'option'"
          [attr.aria-selected]="option.value === internalSelectedValue"
          (mousedown)="selectOption(option, $event)"
          (click)="selectOption(option, $event)"
          (mouseenter)="onOptionMouseEnter($index)"
          style="cursor: pointer; user-select: none;"
        >
          {{ option.label }}
        </div>
      }
    </div>
  }
</div>

